<h1 id="title"></h1>

<style>
	li:hover {
		cursor: move;
	}
</style>
<input type="button" id="create" value="Create new item">
<div id="list"></div>

<script>
		$(() => {
			$.ajax({
				url: 'src/api/get.php',
				type: 'get',
				success: response => {
					let html = '';
					html += '<ul id="items">';

					const parsedResponse = JSON.parse(response);

					$('#title').text('Items list (COUNT: ' + parsedResponse.count + ')');
					$.each(parsedResponse.items, (key, data) => {
						html += '<li class="item">';
						html += '<a class="edit" href data-id="' + data._id +'">Edit</a>&nbsp';
						html += '<a class="delete" href data-id="' + data._id +'" data-desc="' + data.description +'">Delete</a>&nbsp';
						html += '<span>' + data.description + '</span>';
						html += '<img src="' + data.image + '"">';
						html += '</li>';
					});
					html += '</ul>';
					$('#list').html(html);

					const items = $('#items');
					items.sortable({
						update: (event, ui) => {
							let list = [];
							$('#items li').each((idx, elem) => {
								list[idx] = $(elem).html();
							});
						}
					});

					items.disableSelection();

					$('#create').click(() => {
						let url = 'pages/item.php';
						url += '?_=' + (new Date()).getTime();
						$('#content').load(url);
					});

					$('a.edit').click(function(){
						let url = 'pages/item.php';
						url += '?_=' + (new Date()).getTime();
						url += '&id=' + $(this).data('id');
						$('#content').load(url);
						return false;
					});

					$('a.delete').click(function(){
						if(confirm("Are you sure you want to delete the item with the following description: \"" + $(this).data('desc') +'\" ?')){
							$.ajax({
								url: 'src/api/delete.php',
								type: 'post',
								data: {
									id:$(this).data('id')
								},
								success: response => {
									let url = 'pages/list.html';
									url += '?_=' + (new Date()).getTime();
									$('#content').load(url);
								},
								error: (xhr, status, error) => {

								}
							});
						}
						return false;
					});
				},
				error: (xhr, status, error) => {
					alert("Couldn't get items. Try again please.");
				}
			});
		});
</script>